---
- name: Traefik Reverse Proxy
  tags: containers
  docker_container:
    name: traefik
    image: traefik
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /opt/traefik/acme:/etc/traefik/acme
      - /opt/traefik/traefik.toml:/traefik.toml
    ports:
      - 443:443/tcp
      - 80:80/tcp
      - 9000/tcp
    labels:
      traefik.port: "9000"
    restart_policy: unless-stopped
    state: started

- name: Resillio Sync
  tags: containers
  docker_container:
    name: sync
    image: resilio/sync
    volumes:
      - /opt/sync:/mnt/sync
      - /mnt/backup:/mnt/mounted_folders/alpha-backup
      - /opt/factorio:/mnt/factorio
    ports:
      - 55555:5555/tcp
    labels:
      traefik.port: "8888"
    state: started


- name: Datadog Agent
  tags: containers
  docker_container:
    name: Datadog
    image: datadog/docker-dd-agent:latest
    volumes:
     - /var/run/docker.sock:/var/run/docker.sock:ro
     - /proc/:/host/proc/:ro
     - /sys/fs/cgroup/:/host/sys/fs/cgroup:ro
    env:
      API_KEY: "{{ datadog_key }}"
      SD_BACKEND: docker
    labels:
      traefik.enable: false
